<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Pay Slip</title>
</head>

<body>



    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>




    <!-- Font Awesome JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.2/jspdf.debug.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="../payslips/printcss">




    <div id="Index">
        <div id="print" ref="hi">
            <div class="center info headin" style="height: 110px;"><img src="../images/logo" width="100px"
                    style="float: left;" height="100px">
                <div style="vertical-align: middle;"><br>{{company}}</div>
            </div>
            <div class="roww info"></div>
            <div class="center info" style="font-size: 18px;"><b>PAYSLIP FOR MONTH OF {{month}}-{{year}}</b></div><br>

            <table class="info">
                <tr>
                    <td>
                        Employee ID :
                    </td>
                    <td>
                        {{myArray2[0].empid}}
                    </td>
                    <td>
                        Name :
                    </td>
                    <td>
                        {{myArray2[0].name}}
                    </td>
                </tr>
                <tr>
                    <td>
                        Department :
                    </td>
                    <td>
                        {{myArray2[0].department}}
                    </td>
                    <td>
                        Designation :
                    </td>
                    <td>
                        {{myArray2[0].designation}}
                    </td>
                </tr>
                <tr>
                    <td>
                        Phone Number :
                    </td>
                    <td>
                        {{myArray2[0].number}}
                    </td>
                    <td>
                        Account Number :
                    </td>
                    <td>
                        {{myArray2[0].accnum}}
                    </td>
                </tr>

            </table>
            <table class="numbering">
                <tr>
                    <th colspan="2">
                        Earning Amount
                    </th>
                    <th colspan="2">
                        Deduction Amount
                    </th>

                </tr>
                <tr>
                    <td>
                        Basic
                    </td>
                    <td>
                        {{symbol}}{{myArray[0].salary}}
                    </td>
                    <td>
                        Holidays
                    </td>
                    <td>
                        {{symbol}}{{myArray[0].holiday}}
                    </td>
                </tr>
                <tr>
                    <td>
                        Extra Time
                    </td>
                    <td>
                        {{symbol}}{{myArray[0].extratime}}
                    </td>
                    <td>
                        Advance
                    </td>
                    <td>
                        {{symbol}}{{myArray[0].advance}}
                    </td>
                </tr>
                <tr>
                    <td>
                        Bonus
                    </td>
                    <td>
                        {{symbol}}{{myArray[0].bonus}}
                    </td>
                    <td>
                        Deductions
                    </td>
                    <td>
                        {{symbol}}{{myArray[0].deductions}}
                    </td>
                </tr>
                <tr>
                    <th>
                        Total Earnings
                    </th>
                    <th>
                        {{symbol}}{{parseInt(myArray[0].bonus)+parseInt(myArray[0].salary)}}
                    </th>
                    <th>
                        Total Deductions
                    </th>
                    <th>
                        {{symbol}}{{parseInt(myArray[0].advance)+parseInt(myArray[0].holiday)}}
                    </th>
                </tr>
                <tr>
                    <th colspan="2" style="border: none;">

                    </th>
                    <th>
                        Net Pay
                    </th>
                    <th>
                        {{symbol}}{{parseInt(myArray[0].advance)+parseInt(myArray[0].holiday)}}
                    </th>
                </tr>


            </table>
        </div>
    </div>
    <script src="https://unpkg.com/vue@2.6.11/dist/vue.js"></script>

    <!-- jQuery CDN - Slim version (=without AJAX) -->
    <script>
        var log = new Vue({
            el: "#Index",
            data: {
                myArray: [{ empid: '1', salary: '60', advance: '10', holiday: '10', bonus: '5', total: '20', bonus: '0', deductions: '0' }],
                myArray2: [{ empid: '1', name: 'Jimmy Anderson', department: 'Cricket', designation: 'Bowler', phone: '9899989922', accnum: 'xxxx-xxxx-xxxx' }],
                month: '',
                symbol: 'Rs ',
                id: '',
                year: '2020',
                company: 'Company Name',
            },
            created: function () {
                this.load();
            },
            methods: {
                load: function () {
                    var params = this.getParams(window.location.href)
                    this.id = params.id;
                    this.month = params.month
                    this.year = params.year
                    
                    if(params.action=='download'){
                        setTimeout(function () { log.down(); }, 500);
                    }else{
                        this.print()
                    }
                    




                }, print() {
                    var divcontent = document.getElementById('print').innerHTML;
                    window.print()
                    setTimeout(function () { window.close(); }, 3000);

                }, getParams(url) {
                    var params = {};
                    var parser = document.createElement('a');
                    parser.href = url;
                    var query = parser.search.substring(1);
                    var vars = query.split('&');
                    for (var i = 0; i < vars.length; i++) {
                        var pair = vars[i].split('=');
                        params[pair[0]] = decodeURIComponent(pair[1]);
                    }
                    return params;
                }, down() {
                    console.log(this.$refs.hi);
                    window.html2canvas(this.$refs.hi).then(canvas => {
                        image = canvas.toDataURL("image/png", 1.0).replace("image/png", "image/octet-stream");
                        var link = document.createElement('a');
                        link.download = "my-image.png";
                        link.href = image;
                        link.click();
                        window.close()
                    }).catch((error) => {
                        console.log("Erorr Occured", error)
                    });
                    
                }

            }
        })

    </script>

</body>

</html>